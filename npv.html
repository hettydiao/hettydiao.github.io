<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>NPV Visualizer</title>
  <link rel="stylesheet" href="https://pyscript.net/releases/2024.5.2/core.css">
  <script type="module" src="https://pyscript.net/releases/2024.5.2/core.js"></script>
  <style>
    body { font-family: system-ui, -apple-system, Segoe UI, Arial, sans-serif; max-width: 900px; margin: 24px auto; padding: 0 16px; }
    .row { display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 12px; }
    label { font-size: 14px; }
    input, button, textarea { width: 100%; padding: 8px; font-size: 14px; }
    textarea { height: 70px; }
    #kpi { font-weight: 700; margin-top: 6px; }
    .card { border: 1px solid #eee; border-radius: 12px; padding: 16px; box-shadow: 0 1px 2px rgba(0,0,0,0.04); }
  </style>
</head>
<body>

  <h1>ðŸ’¸ Net Present Value (NPV) Calculator</h1>

  <div class="card">
    <div class="row">
      <div>
        <label>Discount rate (e.g., 0.05 = 5%)</label>
        <input id="rate" type="number" step="0.005" min="0" value="0.05">
      </div>
      <div>
        <label>Initial investment (positive)</label>
        <input id="initial" type="number" step="100" min="0" value="1000">
      </div>
      <div>
        <label>Number of years</label>
        <input id="years" type="number" step="1" min="1" value="5">
      </div>
    </div>

    <div style="margin-top:12px;">
      <label>Cash flows (comma separated, must match years)</label>
      <textarea id="cflows">400, 400, 400, 400, 400</textarea>
    </div>

    <div style="margin-top:12px;">
      <button id="run">Compute NPV</button>
      <div id="kpi">NPV = $0.00</div>
    </div>
  </div>

  <script type="py">
from js import document, console

def fmt_money(x):
    return f"${x:,.2f}"

def compute_npv(rate, initial, cash_flows):
    years = list(range(1, len(cash_flows)+1))
    discounted = [cf / ((1+rate)**t) for t, cf in zip(years, cash_flows)]
    npv = sum(discounted) - initial
    return npv

def on_run(event=None):
    try:
        r = float(document.querySelector("#rate").value)
        initial = float(document.querySelector("#initial").value)
        years = int(document.querySelector("#years").value)
        flows = document.querySelector("#cflows").value.replace(" ", "").split(",")
        flows = [float(x) for x in flows if x]

        if len(flows) != years:
            raise ValueError(f"Expected {years} cash flows but got {len(flows)}.")

        npv = compute_npv(r, initial, flows)
        document.querySelector("#kpi").innerHTML = f"NPV = {fmt_money(npv)} âœ…"

    except Exception as e:
        console.log(e)
        document.querySelector("#kpi").innerHTML = f"<span style='color:red'>Error: {e}</span>"

document.querySelector("#run").addEventListener("click", on_run)
  </script>

</body>
</html>
